<style>
.green {
	color: green;
}

.red {
	color: red;
}

.white {
	color: white;
}

.sticky {
	position: -webkit-sticky;
	position: -moz-sticky;
	position: -ms-sticky;
	position: -o-sticky;
	position: sticky;
	top: 0px;
}
.channel-pick-buttons {
	margin-top: 5px;
	margin-bottom: 5px;
	display: inline-block;
	cursor: pointer;
}

table {
	display: inline !important;/*to override table-responsive so we can keep our sticky table header*/
}
</style>
<div class="container">
	<h3>
		Way <a style="color: inherit" href="https://en.wikipedia.org/wiki/Over-the-top_content" target="_blank">Over the Top</a>
	</h3>
	<div class="row">
		<div class="col">
			<button
			  class="btn btn-outline-primary channel-pick-buttons" 
			  on:click='set({ channelPickMode: !channelPickMode })'
			>
			{{#if channelPickMode}}Done{{else}}Pick Channels{{/if}}
			</button>
		</div>
		<div class="col">
			{{#if channelPickMode}}
			<div class="text-right">
		      	<button class="btn btn-outline-primary channel-pick-buttons" on:click="showAllChannels(true)"><span class="hidden-sm-down">Select{{" "}}</span>All</button>
		        <button class="btn btn-outline-primary channel-pick-buttons" on:click="showAllChannels(false)"><span class="hidden-sm-down">Select{{" "}}</span>None</button>
		    </div>
		    {{/if}}
		</div>
	</div>
	{{#if channelPickMode}}
	<ChannelSelector channels="{{channelLineup}}" visibleChannels="{{visibleChannels}}" bind:shown />
	{{else}}
	<ChannelList channels="{{visibleChannels}}" />
	{{/if}}
</div>
<script>
import channelLineup from './data/provider-channels.js'
import ChannelList from './ChannelList.html'
import ChannelSelector from './ChannelSelector.html'

export default {
	data() {
		const shown = {}

		channelLineup.forEach(channel => {
			shown[channel.Name] = true
		})

		const localStorageShownChannels = localStorage.getItem('shownChannels')
		if(localStorageShownChannels) {
			Object.assign(shown, JSON.parse(localStorageShownChannels))
		}
		
		return {
			channelLineup,
			shown
		}
	},
	computed: {
		visibleChannels: (channelLineup, shown) => {
			return channelLineup.filter(channel => shown[channel.Name])
		}
	},
	components: {
		ChannelSelector,
		ChannelList
	},
	methods: {
		showAllChannels(show) {
			const shown = this.get('shown')
			Object.keys(shown).forEach(function(channel) {
			    shown[channel] = show
			});

			this.set({ shown })
			if(show) localStorage.removeItem('shownChannels')
			else localStorage.setItem('shownChannels', JSON.stringify(shown))
			
		}
	}
}
</script>
